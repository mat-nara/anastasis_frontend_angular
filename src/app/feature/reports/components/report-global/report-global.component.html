<div class="container">
  <div class="header">
    <p class="mat-display-1 title">Vue globale</p>
  </div>
  <div class="filter d-flex justify-content-between align-items-baseline mb-2">
    <mat-form-field appearance="standard" floatLabel="always">
      <mat-label>Rechercher</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="" #input >
    </mat-form-field>
    <div>
      <button mat-raised-button color="primary" class="me-1" (click)="openSumDialog()">Récapitulatif</button>
    </div>
  </div>
  <div class="content">
    <div class="table-wrapper wrapper mat-elevation-z8">
      <table mat-table class="" [dataSource]="reportDataSource" matSort matSortDisableClear matSortDirection="desc" >
      
        <!-- CODE -->
        <ng-container matColumnDef="CODE" sticky>
          <th mat-header-cell *matHeaderCellDef>Code</th>
          <td mat-cell *matCellDef="let article"> {{ article.CODE }} </td>
        </ng-container>

        <!-- labs -->
        <ng-container matColumnDef="labs" sticky>
          <th mat-header-cell *matHeaderCellDef>Labs</th>
          <td mat-cell *matCellDef="let article"> {{ article.labs }} </td>
        </ng-container>

        <!-- designation -->
        <ng-container matColumnDef="designation" sticky>
          <th mat-header-cell *matHeaderCellDef>Désignation</th>
          <td mat-cell *matCellDef="let article"> {{ article.designation }} </td>
        </ng-container>




        <!--******************************   ROTATION DES STOCKS **************************-->

        <!-- cmm -->
        <ng-container matColumnDef="cmm">
          <th mat-header-cell *matHeaderCellDef>CMM</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.cmm }} </td>
        </ng-container>

        <!-- fmr -->
        <ng-container matColumnDef="fmr">
          <th mat-header-cell *matHeaderCellDef>FMR</th>
          <td mat-cell *matCellDef="let article">
            <container-element [ngSwitch]="article.rotation_de_stocks.fmr">
              <mat-chip-list>
                <mat-chip *ngSwitchCase="'Faible rotation'" class="bg-white" >{{ article.rotation_de_stocks.fmr }}</mat-chip>
                <mat-chip *ngSwitchCase="'Moyen rotation'"  class="bg-yellow">{{ article.rotation_de_stocks.fmr }}</mat-chip>
                <mat-chip *ngSwitchCase="'Forte rotation'"  class="bg-orange">{{ article.rotation_de_stocks.fmr }}</mat-chip>
              </mat-chip-list>
            </container-element>
          </td>
        </ng-container>

        <!-- stock_min -->
        <ng-container matColumnDef="stock_min">
          <th mat-header-cell *matHeaderCellDef>Stock min</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_min }} </td>
        </ng-container>

        <!-- stock_max -->
        <ng-container matColumnDef="stock_max">
          <th mat-header-cell *matHeaderCellDef>Stock max</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_max }} </td>
        </ng-container>

        <!-- stock_reel_a_une_date -->
        <ng-container matColumnDef="stock_reel_a_une_date">
          <th mat-header-cell *matHeaderCellDef>Stock réel à une date</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_reel_a_une_date }} </td>
        </ng-container>

        <!-- stock_dispo -->
        <ng-container matColumnDef="stock_dispo">
          <th mat-header-cell *matHeaderCellDef>Stock dispo</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_dispo }} </td>
        </ng-container>

        <!-- etat_reel -->
        <ng-container matColumnDef="etat_reel">
          <th mat-header-cell *matHeaderCellDef>Etat réel</th>
          <td mat-cell *matCellDef="let article"> 
            <container-element [ngSwitch]="article.rotation_de_stocks.etat_reel">
              <mat-chip-list>
                <mat-chip *ngSwitchCase="'Surstock'"  class="bg-red" >{{ article.rotation_de_stocks.etat_reel }}</mat-chip>
                <mat-chip *ngSwitchDefault            class="bg-white">{{ article.rotation_de_stocks.etat_reel }}</mat-chip>
              </mat-chip-list>
            </container-element>
          </td>
        </ng-container>

        <!-- stock_en_transit -->
        <ng-container matColumnDef="stock_en_transit">
          <th mat-header-cell *matHeaderCellDef>Stock en transit</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_en_transit }} </td>
        </ng-container>

        <!-- date_prevu_arrivage -->
        <ng-container matColumnDef="date_prevu_arrivage">
          <th mat-header-cell *matHeaderCellDef>Date prévu d'arrivage</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.date_prevu_arrivage  | date: 'd MMM y'  }} </td>
        </ng-container>

        <!-- stock_a_terme -->
        <ng-container matColumnDef="stock_a_terme">
          <th mat-header-cell *matHeaderCellDef>Stock à terme</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_a_terme }} </td>
        </ng-container>

        <!-- stock_a_terme_mois -->
        <ng-container matColumnDef="stock_a_terme_mois">
          <th mat-header-cell *matHeaderCellDef>Stock à terme [mois]</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.stock_a_terme_mois }} </td>
        </ng-container>

        <!-- observation -->
        <ng-container matColumnDef="observation">
          <th mat-header-cell *matHeaderCellDef>observation</th>
          <td mat-cell *matCellDef="let article"> {{ article.rotation_de_stocks.observation }} </td>
        </ng-container>




         <!--******************************   DECISION   **************************-->


        <!-- stock_de_securite -->
        <ng-container matColumnDef="stock_de_securite">
          <th mat-header-cell *matHeaderCellDef>Stock de sécurite</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.stock_de_securite }} </td>
        </ng-container>

        <!-- QEC_theorique_boite -->
        <ng-container matColumnDef="QEC_theorique_boite">
          <th mat-header-cell *matHeaderCellDef>QEC théorique [boite]</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.QEC_theorique_boite }} </td>
        </ng-container>

        <!-- QEC_boites_decision -->
        <ng-container matColumnDef="QEC_boites_decision">
          <th mat-header-cell *matHeaderCellDef>QEC boîtes décision</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.QEC_boites_decision }} </td>
        </ng-container>

        <!-- QEC_cartons_decision -->
        <ng-container matColumnDef="QEC_cartons_decision">
          <th mat-header-cell *matHeaderCellDef>QEC cartons décision</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.QEC_cartons_decision }} </td>
        </ng-container>

        <!-- QEC_final -->
        <ng-container matColumnDef="QEC_final">
          <th mat-header-cell *matHeaderCellDef>QEC final</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.QEC_final }} </td>
        </ng-container>

        <!-- volume_commande -->
        <ng-container matColumnDef="volume_commande">
          <th mat-header-cell *matHeaderCellDef>Volume de la commande</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.volume_commande }} </td>
        </ng-container>

        <!-- poids_commande -->
        <ng-container matColumnDef="poids_commande">
          <th mat-header-cell *matHeaderCellDef>Poids de la commande</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.poids_commande }} </td>
        </ng-container>

        <!-- montant_decision -->
        <ng-container matColumnDef="montant_decision">
          <th mat-header-cell *matHeaderCellDef>Montant decision</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.montant_decision }} </td>
        </ng-container>

        <!-- QEC_boites_propo_dirappro -->
        <ng-container matColumnDef="QEC_boites_propo_dirappro">
          <th mat-header-cell *matHeaderCellDef>QEC boites propo dirappro</th>
          <td mat-cell *matCellDef="let article"> 
            <mat-form-field appearance="outline">
              <mat-label></mat-label>
              <input matInput type="number" min="0"
                  [attr.CODE]="article.CODE" 
                  [(ngModel)]="article.decision.QEC_boites_propo_dirappro"
                  (change)="onPropDiraproChanged($event)"
              />
            </mat-form-field>  
          </td>
        </ng-container>

        <!-- QEC_cartons_propo_dirrapro -->
        <ng-container matColumnDef="QEC_cartons_propo_dirrapro">
          <th mat-header-cell *matHeaderCellDef>QEC cartons propo dirrapro</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.QEC_cartons_propo_dirrapro }} </td>
        </ng-container>


        <!-- montant_propo_dirrapro -->
        <ng-container matColumnDef="montant_propo_dirrapro">
          <th mat-header-cell *matHeaderCellDef>Montant propo dirrapro</th>
          <td mat-cell *matCellDef="let article"> {{ article.decision.montant_propo_dirrapro }} </td>
        </ng-container>




        <!--******************************   COLLISAGE   **************************-->


        <!-- poids -->
        <ng-container matColumnDef="poids">
          <th mat-header-cell *matHeaderCellDef>Poids</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.poids }} </td>
        </ng-container>

        <!-- dimension -->
        <ng-container matColumnDef="dimension">
          <th mat-header-cell *matHeaderCellDef>Dimension</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.dimension }} </td>
        </ng-container>

        <!-- pu_decision -->
        <ng-container matColumnDef="pu_decision">
          <th mat-header-cell *matHeaderCellDef>PU decision</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.pu_decision }} </td>
        </ng-container>

        <!-- dev_decision -->
        <ng-container matColumnDef="dev_decision">
          <th mat-header-cell *matHeaderCellDef>DEV decision</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.dev_decision }} </td>
        </ng-container>

        <!-- collisage_decision -->
        <ng-container matColumnDef="collisage_decision">
          <th mat-header-cell *matHeaderCellDef>Collisage décision</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.collisage_decision }} </td>
        </ng-container>

        <!-- FOB -->
        <ng-container matColumnDef="FOB">
          <th mat-header-cell *matHeaderCellDef>FOB</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.FOB }} </td>
        </ng-container>

        <!-- coef -->
        <ng-container matColumnDef="coef">
          <th mat-header-cell *matHeaderCellDef>coef</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.coef }} </td>
        </ng-container>

        <!-- prix_de_revient -->
        <ng-container matColumnDef="prix_de_revient">
          <th mat-header-cell *matHeaderCellDef>Prix de revient</th>
          <td mat-cell *matCellDef="let article"> {{ article.collisage.prix_de_revient }} </td>
        </ng-container>

      
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </div>
    <mat-paginator class="mt-3" [pageSizeOptions]="[8, 10, 25, 50,  100]" aria-label="Select page of users"></mat-paginator>
  </div>
</div>

<div class="btn-float" *ngIf="propChanged">
  <button mat-fab color="primary" (click)="updatePropDirrapro()">
    <mat-icon>edit</mat-icon>
  </button>
</div>